<link href="~/DataTables/datatables.min.css" rel="stylesheet" />
<script src="~/DataTables/datatables.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.min.js"></script>
<script>
    @* Datatable *@
    $(document).ready(function () {
        $("#tblPersonalInfo").DataTable({
            "processing": true,
            "serverSide": true,
            "filter": true, //Search Box
            "orderMulti": false,
            "stateSave": true,
            "ajax": {
                "url": "/PersonalInfo/DataTabelData",
                "type": "POST",
                "datatype": "json"
            },
            "columnDefs":
                [
                    { "targets": [0], "visible": false, "searchable": false },
                    { "orderable": false, "targets": 7 },
                    { "orderable": false, "targets": 8 }
                ],
            "columns": [
                { "data": "ID", "name": "ID", "autoWidth": true },
                { "data": "ID", "name": "ID", "autoWidth": true },
                { "data": "FirstName", "name": "FirstName", "autoWidth": true },
                {
                    "data": "DateOfBirth",
                    "name": "DateOfBirth",
                    "autoWidth": true,
                    "render": function (data) {
                        var date = new Date(data);
                        var month = date.getMonth() + 1;
                        return (month.length > 1 ? month : "0" + month) + "/" + date.getDate() + "/" + date.getFullYear();
                    }
                },
                { "data": "City", "name": "City", "autoWidth": true },
                { "data": "Country", "name": "Country", "autoWidth": true },
                { "data": "MobileNo", "name": "MobileNo", "autoWidth": true },
                {
                    data: null, render: function (data, type, row) {
                        return "<a href='#' class='btn btn-info' onclick=AddEditPersonalInfo('" + row.ID + "');>Edit</a>";
                    }
                },
                {
                    data: null, render: function (data, type, row) {
                        return "<a href='#' class='btn btn-danger' onclick=DeletePersonalInfo('" + row.ID + "'); >Delete</a>";
                    }
                }
            ],
            "lengthMenu": [[7, 10, 15, 25, 50, 100, 200], [7, 10, 15, 25, 50, 100, 200]],
        });
    });


    @* CRUD *@
    var AddEditPersonalInfo = function (id) {
        var url = "/PersonalInfo/AddEditPersonalInfo?id=" + id;
        if (id > 0)
            $('#title').html("Edit Personal Info");

        $("#PersonalInfoFormModelDiv").load(url, function () {
            $("#PersonalInfoFormModel").modal("show");

        });
    };

    $('body').on('click', "#btnSubmit", function () {
        var myformdata = $("#PersonalInfoForm").serialize();

        if ($.trim($('#FirstName').val()) === '') {
            Swal.fire({
                title: "Alert", text: "First Name can not be left blank.",
                icon: "info", closeOnConfirm: false,
                onAfterClose: () => {
                    setTimeout(() => $("#FirstName").focus(), 110);
                }
            });
            return;
        }
        if ($.trim($('#LastName').val()) === '') {
            Swal.fire({
                title: "Alert", text: "Last Name can not be left blank.",
                icon: "info", closeOnConfirm: false,
                onAfterClose: () => {
                    setTimeout(() => $("#LastName").focus(), 110);
                }
            });
            return;
        }

        $.ajax({
            type: "POST",
            url: "/PersonalInfo/Create",
            data: myformdata,
            success: function (result) {
                $("#PersonalInfoFormModel").modal("hide");

                Swal.fire({
                    title: "Alert!",
                    text: result,
                    type: "Success"
                }).then(function () {
                    $('#tblPersonalInfo').DataTable().ajax.reload();
                });
            },
            error: function (errormessage) {
                alert(errormessage.responseText);
            }
        });
    });

    var DeletePersonalInfo = function (id) {
        Swal.fire({
            title: 'Do you want to delete this item?',
            type: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Yes'
        }).then((result) => {
            if (result.value) {
                $.ajax({
                    type: "POST",
                    url: "/PersonalInfo/Delete/" + id,
                    success: function () {
                        Swal.fire({
                            title: 'Deleted!', text: 'Item has been deleted.',
                            icon: "success", closeOnConfirm: false,
                            onAfterClose: () => {
                                $('#tblPersonalInfo').DataTable().ajax.reload();
                            }
                        });
                    }
                });
            }
        });
    };
</script>